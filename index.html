<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>ğŸ’–</title>
<style>
  /* å…¨å±€æ–‡å­—ä¸å¯é€‰ */
  * {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  :root{ --glow-r1:10px; --glow-r2:22px; }
  html,body{
    height:100%;margin:0;overflow:hidden;
    font-family: "Microsoft YaHei", sans-serif;
    transition:background 1s;
    background:
      radial-gradient(1200px 600px at 50% 45%, rgba(255,255,255,.65), rgba(255,255,255,0) 60%),
      radial-gradient(circle at 50% 45%, #fff4f7 0%, #c9eaff 100%);
  }
  body.dark{
    background:
      radial-gradient(1200px 600px at 50% 45%, rgba(18,18,18,.8), rgba(0,0,0,0) 60%),
      radial-gradient(circle at 50% 45%, #121212 0%, #000000 100%);
    color:#eee;
  }
  body.dark.eco{ --glow-r1:6px; --glow-r2:14px; }
  .stage{position:relative;width:100%;height:100%;}
  .msg{
    position:absolute;left:50%;top:50%;
    padding:10px 16px;border-radius:16px;
    color:#fff;font-weight:700;
    font-size:clamp(14px,3vmin,22px);
    text-shadow:0 2px 8px rgba(0,0,0,.28);
    opacity:0;
    transform:translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot));
    animation: flight var(--dur) cubic-bezier(.25,.7,.3,1) var(--delay) both;
    box-shadow:0 8px 26px rgba(0,0,0,.22);
    will-change: transform, opacity;
    background: var(--bg);
  }
  /* ç¬¬ä¸€é˜¶æ®µåŠ¨ç”»ï¼ˆæ•£å¼€â†’å›æ”¶â†’å®šå‹ï¼‰ */
  @keyframes flight{
    0%{ opacity:0; transform:translate(-50%,-50%) translate(var(--dx),var(--dy)) scale(.75) rotate(var(--rot)); }
    18%{ opacity:1; }
    45%{ transform:translate(-50%,-50%) translate(calc(var(--dx)*.2),calc(var(--dy)*.2)) scale(1.06); }
    70%{ transform:translate(-50%,-50%) translate(calc(var(--dx)*1.15),calc(var(--dy)*1.15)) scale(.95) rotate(var(--rot)); }
    88%{ transform:translate(-50%,-50%) translate(calc(var(--heart-x)*.6),calc(var(--heart-y)*.6)) scale(.9) rotate(var(--heart-rot)); }
    100%{ opacity:1; transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot)); }
  }
  /* å¿ƒç“£ä¼ªå…ƒç´  */
  .msg::before,.msg::after{
    content:''; position:absolute; left:50%; top:0;
    background:inherit; border-radius:50px 50px 0 0;
    width:22px; height:34px; opacity:0; transition:opacity .28s ease;
    transform-origin:0 100%; transform:rotate(-45deg); z-index:0;
  }
  .msg::after{ left:0; transform-origin:100% 100%; transform:rotate(45deg); }
  .msg.heart-mode{ color:#fff; }
  .msg .text{ position:relative; z-index:1; }
  .msg.heart-mode::before,.msg.heart-mode::after{ opacity:1; }
  .msg.locked{ animation:none; transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1) rotate(var(--heart-rot)); opacity:1; }
  .msg.locked.pulse{ animation:pulse 2.2s ease-in-out 1; }
  /* é”å®šåå‡è´Ÿï¼šéšè—ç“£å½¢ä¼ªå…ƒç´ ï¼Œç§»é™¤è¾‰å…‰å¹¶å‡è½»æ–‡å­—é˜´å½± */
  .msg.locked::before,.msg.locked::after{ display:none; }
  body.dark .msg.locked{ filter:none; }
  .msg.locked .text{ text-shadow:0 1px 2px rgba(0,0,0,.12); }
  @keyframes pulse{
    0%,100%{ transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1); }
    50%   { transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1.08); }
  }
  /* çˆ†ç‚¸é˜¶æ®µï¼ˆä¿ç•™ä»¥å¤‡å°†æ¥ä½¿ç”¨ï¼‰ */
  .msg.burst{ animation: burst 1.4s cubic-bezier(.17,.6,.2,1) forwards; }
  @keyframes burst{
    0%{ opacity:1; transform:translate(-50%,-50%) translate(var(--heart-x),var(--heart-y)) scale(1); filter:blur(0); }
    70%{ opacity:.9; transform:translate(-50%,-50%) translate(calc(var(--heart-x) + var(--bx)*0.7), calc(var(--heart-y) + var(--by)*0.7)) scale(.9) rotate(var(--rot)); filter:blur(.3px); }
    100%{ opacity:0; transform:translate(-50%,-50%) translate(calc(var(--heart-x) + var(--bx)), calc(var(--heart-y) + var(--by))) scale(.7) rotate(var(--rot)); filter:blur(1px); }
  }
  .center-title{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    font-weight:800; letter-spacing:.12em; font-size:clamp(18px,4vmin,28px);
    color:rgba(255,105,180,.7); text-shadow:0 2px 10px rgba(255,105,180,.18);
    opacity:.0; pointer-events:none; animation:titleIn 1.2s ease 0.8s both;
  }
  body.dark .center-title{ color:rgba(255,160,200,.9); text-shadow:0 0 18px rgba(255,130,200,.35); }
  @keyframes titleIn{ from{opacity:0; transform:translate(-50%,-55%);} to{opacity:.95; transform:translate(-50%,-50%);} }
  /* ä¿®æ”¹åçš„æ§åˆ¶æŒ‰é’®æ ·å¼ */
  .controls{ 
    position:fixed; right:15px; bottom:50px; display:none; /* é»˜è®¤éšè— */
    gap:8px; align-items:center; z-index: 9999;
  }
  
  /* ç¼©å°æŒ‰é’®å°ºå¯¸ */
  .controls .btn {
    padding: 8px 12px;
    font-size: 13px;
  }
  
  .btn{ 
    padding:10px 14px; 
    border:none; 
    border-radius:10px; 
    background:rgba(255,255,255,0.4); 
    backdrop-filter:blur(8px); 
    color:#222; 
    font-weight:600; 
    cursor:pointer; 
    box-shadow:0 5px 20px rgba(0,0,0,0.25); 
    font-size:clamp(14px, 2.5vmin, 18px); 
    transition:all 0.3s; 
  }
  
  body.dark .btn{ 
    background:rgba(50, 50, 50, 0.4); 
    color:#eee; 
    box-shadow:0 5px 20px rgba(0,0,0,0.5); 
  }
  
  .btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  }
  
  body.dark .btn:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.7);
  }
  
  /* å¼¹çª—ç¡®å®šæŒ‰é’®æ ·å¼ï¼ˆä¸ä¾¿ç­¾.htmlä¿æŒä¸€è‡´ï¼‰ */
  .btn.primary {
    padding: 7px 12px; /* å‡å°å†…è¾¹è· */
    font-size: 14px; /* å‡å°å­—ä½“å¤§å° */
    background-color: #ff6b6b;
    color: white;
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
  }
  .btn.primary:hover {
    background-color: #ff5252;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
  }
  .btn.primary:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
  }
  
  body.dark .btn.primary {
    background-color: #ff6b6b;
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.5);
  }
  
  body.dark .btn.primary:hover {
    background-color: #ff5252;
    box-shadow: 0 6px 16px rgba(255, 107, 107, 0.6);
  }
  
  /* é›ªèŠ± */
  .snow{ position:fixed; top:-10px; color:white; user-select:none; pointer-events:none; z-index:99; text-shadow:0 0 8px rgba(255,255,255,.8); animation:snowfall linear forwards; }
  @keyframes snowfall{ 0%{ transform:translateY(0) rotate(0deg); opacity:1;} 100%{ transform:translateY(100vh) rotate(360deg); opacity:0;} }
  /* ä¿®æ”¹åçš„å¼¹çª—ç›¸å…³CSSï¼ˆä¸ä¾¿ç­¾.htmlä¿æŒä¸€è‡´ï¼‰ */
  .modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .modal-backdrop.active {
    opacity: 1;
    visibility: visible;
  }
  .modal {
    background-color: #ffffff;
    padding: 0 0 15px;
    border-radius: 12px;
    text-align: center;
    width: 90%;
    max-width: 380px; /* æ”¶çª„å¼¹çª—å®½åº¦ */
    transform: scale(0.9);
    transition: transform 0.3s ease;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    overflow: hidden;
  }
  body.dark .modal {
    background-color: #2a2a2a;
  }
  body.dark .title {
    color: #f0f0f0;
  }
  body.dark .content {
    color: #ccc;
  }
  .modal-backdrop.active .modal {
    transform: scale(1);
  }
  .titlebar {
    width: 100%;
    margin: 0 0 10px;
    padding: 8px 0;
    background-color: #fff0f0;
    border-radius: 12px 12px 0 0;
    text-align: center;
  }
  .icon {
    font-size: 26px;
    display: inline-block;
    margin-bottom: 6px;
    animation: bounce 1.5s infinite;
  }
  .title {
    font-size: 16px;
    font-weight: 800;
    color: #333;
  }
  .content {
    font-size: 15px;
    color: #666;
    margin: 0 25px 18px; /* å‡å°å·¦å³è¾¹è· */
    line-height: 1.5;
  }
  .actions {
    display: flex;
    justify-content: center;
    margin: 0 25px 5px; /* å‡å°å·¦å³è¾¹è· */
  }
  @keyframes bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }
  /* ä¿®æ”¹åçš„åº•éƒ¨æ ‡è¯†æ ·å¼ï¼ˆä¸ä¾¿ç­¾.htmlä¿æŒä¸€è‡´ï¼‰ */
  .footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 0px 0px;
    text-align: center;
    background: rgba(255, 255, 255, 0.2); /* å¢åŠ èƒŒæ™¯ä¸é€æ˜åº¦ */
    backdrop-filter: blur(8px);
    border-top: 1px solid rgba(0, 0, 0, 0.2); /* åŠ æ·±è¾¹æ¡† */
    z-index: 1000;
    font-size: 12px;
    color: rgba(0, 0, 0, 0.9); /* å¢åŠ æ–‡å­—å¯¹æ¯”åº¦ */
    display: none; /* åˆå§‹éšè— */
  }

  body.dark .footer {
    background: rgba(0, 0, 0, 0.2); /* å¢åŠ èƒŒæ™¯ä¸é€æ˜åº¦ */
    color: rgba(255, 255, 255, 0.9); /* å¢åŠ æ–‡å­—å¯¹æ¯”åº¦ */
    border-top: 1px solid rgba(255, 255, 255, 0.3); /* åŠ æ·±è¾¹æ¡† */
  }

  .footer-line {
    margin: 3px 0; /* å‡å°è¡Œé—´è· */
    line-height: 1.3;
  }

  .footer a {
    color: inherit;
    text-decoration: none;
    transition: opacity 0.3s;
    font-weight: 600; /* å¢åŠ å­—ä½“ç²—ç»† */
  }

  .footer a:hover {
    opacity: 0.8;
    text-decoration: underline;
  }

  .footer svg {
    vertical-align: text-bottom;
    margin-right: 4px;
  }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="center-title" id="title">for you â™¥</div>
  </div>
  <!-- ä¿®æ”¹åçš„å¼¹çª—HTMLç»“æ„ï¼ˆä¸ä¾¿ç­¾.htmlä¿æŒä¸€è‡´ï¼‰ -->
  <div class="modal-backdrop" id="start-backdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="titlebar">
        <span class="icon">â¤ï¸</span>
        <span class="title" id="modal-title">ç¤¼ç‰©</span>
      </div>
      <div class="content">æ‚¨æœ‰ä¸€ä»½ç¤¼ç‰©ï¼Œç¡®å®šè¦æ‰“å¼€å—ï¼Ÿ</div>
      <div class="actions">
        <button class="btn primary" id="confirm-btn" autofocus>ç¡®å®š</button>
      </div>
    </div>
  </div>
  <div class="controls">
    <button class="btn" id="themeBtn">åˆ‡æ¢ä¸»é¢˜</button>
    <button class="btn" id="replay">é‡æ’­ / åˆ‡æ¢èƒŒæ™¯</button>
  </div>

  <!-- ä¿®æ”¹åçš„åº•éƒ¨æ ‡è¯† -->
  <footer class="footer" id="page-footer">
    <div class="footer-line">
      Designed & Maintained by <a href="https://www.douyin.com/user/MS4wLjABAAAA_ml9jDiT3gM8tu-K2JI-aUTF_xXL-F1U3CZl8s-cacs?showTab=post" target="_blank" rel="noopener noreferrer">å•Šå•µå‘²å˜š</a>
    </div>
    <div class="footer-line">
      <a href="https://github.com/SCTRE" target="_blank" rel="noopener noreferrer">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        GitHub
      </a>
    </div>
  </footer>

  <!-- æ–°å¢éŸ³ä¹æ’­æ”¾æ ‡ç­¾ -->
  <audio id="bgMusic" preload="auto">
    <source src="https://lf9-music-east.douyinstatic.com/obj/ies-music-hj/7495920705440140091.mp3" type="audio/mpeg">
  </audio>
<script>
/* ä½ å–œæ¬¢çš„å¥å­ */
const tips=[
  'æƒ³å¿µåœ¨é£é‡Œé£˜','æœˆäº®ä¸ºä½ äº®','å–œæ¬¢ä½ å¾ˆä¹…äº†','ä½ æ˜¯æˆ‘çš„å¿ƒåŠ¨','æ¸©æŸ”è½åœ¨äººé—´',
  'æ˜Ÿå…‰éƒ½ä¸ºä½ é—ª','æ¢¦é‡Œæœ‰ä½ çœŸå¥½','ä¸–ç•Œå› ä½ æŸ”è½¯','å¿ƒè·³ä¸ºä½ åŠ é€Ÿ','æœ‰ä½ çœŸå¥½',
  'ä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„å…‰','é‡è§ä½ æ˜¯æµªæ¼«çš„å¼€å§‹','æ™šé£ä¹Ÿæ¸©æŸ”äº†','ä½ çš„ç¬‘èåŒ–æ˜Ÿæµ·',
  'æƒ³é™ªä½ çœ‹æ˜Ÿæ˜Ÿ','ä»Šå¤œçš„æ¢¦ç»™ä½ ','å®‡å®™éƒ½åœ¨åçˆ±ä½ ','ä½ æ˜¯äººé—´çš„å¥‡è¿¹',
  'æ‹¥æŠ±è¦ç´§ä¸€ç‚¹','æƒ³ä½ æˆä¹ æƒ¯äº†','ä¸€ç¬ä¹Ÿæ˜¯æ°¸æ’','ä½ çœ¼é‡Œæœ‰æ˜Ÿæ˜Ÿ','ä½ çš„æ¸©æŸ”è®©æˆ‘æ²¦é™·',
  'é£éƒ½æ˜¯ç”œçš„','ä¸ºä½ å¿ƒåŠ¨ä¸æ­¢','æƒ³æˆä¸ºä½ çš„ä¾‹å¤–','å¿ƒæœ‰æ¡ƒèŠ±ä¸€ç‰‡','ä½ æ˜¯æˆ‘æ¢¦é‡Œçš„æµ·',
  'æƒ³å’Œä½ çœ‹æµ·','æ­¤åˆ»çš„é£æƒ³ä½ ','é‡è§ä½ åæ—¶é—´å˜æ…¢','æ‰€æœ‰æµªæ¼«éƒ½ä¸ä½ æœ‰å…³',
  'æƒ³é è¿‘ä½ ä¸€ç‚¹','ä½ çš„åå­—æ˜¯æˆ‘å¿ƒäº‹','å¿ƒè½¯æ˜¯å› ä¸ºä½ ','æƒ³ç‰µä½ çš„æ‰‹çœ‹æ—¥è½',
  'æ¯æ¬¡æƒ³ä½ æ˜Ÿæ˜Ÿéƒ½äº®äº†','å¿ƒè·³è—ä¸ä½','æœ‰ä½ ä¸–ç•Œäº®ä¸€ç‚¹','ç”œåœ¨é£é‡Œä¹Ÿåœ¨å¿ƒé‡Œ'
];
const stage  = document.getElementById('stage');
const replay = document.getElementById('replay');
const title  = document.getElementById('title');
const themeBtn = document.getElementById('themeBtn');
const controls = document.querySelector('.controls');
const bgMusic = document.getElementById('bgMusic'); // è·å–éŸ³ä¹å…ƒç´ 
let dark = false;       // æ·±è‰²æ¨¡å¼
let eco = false;        // çœç”µæ¡£
let snowRunning = false;
let snowFrame; let lastSnowTime = 0;
let snowIntervalMs = 700; // é›ªèŠ±ç”Ÿæˆé—´éš”
let snowMax = 120;        // æœ€å¤§é›ªèŠ±æ•°é‡
let totalCurrent = 0;     // å½“å‰ç”Ÿæˆç²’å­æ€»æ•°
let lockedCount = 0;      // å·²é”å®šæ•°é‡
/* å¤–æŠ›æ–¹å‘ */
const directions = [
  {dx:'0vw',dy:'-80vh'},{dx:'0vw',dy:'80vh'},
  {dx:'-80vw',dy:'0vh'},{dx:'80vw',dy:'0vh'},
  {dx:'-70vw',dy:'-70vh'},{dx:'70vw',dy:'-70vh'},
  {dx:'-70vw',dy:'70vh'},{dx:'70vw',dy:'70vh'},
  {dx:'0vw',dy:'-60vh'},{dx:'0vw',dy:'60vh'},
  {dx:'-60vw',dy:'0vh'},{dx:'60vw',dy:'0vh'}
];
// éŸ³ä¹æ’­æ”¾å‡½æ•°ï¼šæ¯æ¬¡æ’­æ”¾ä»å¤´å¼€å§‹ï¼Œä»…æ’­æ”¾ä¸€æ¬¡
function playMusic() {
  bgMusic.currentTime = 0;
  bgMusic.play().catch(err => {
    // å¤„ç†è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼šå¼•å¯¼ç”¨æˆ·äº¤äº’åæ’­æ”¾
    const triggerPlay = () => {
      bgMusic.play();
      document.body.removeEventListener('click', triggerPlay);
    };
    document.body.addEventListener('click', triggerPlay);
  });
}
function rand(min,max){return Math.random()*(max-min)+min;}
function hexToRgba(hex,alpha=1){
  const h=hex.replace('#','');
  const short=h.length===3;
  const r=parseInt(short? h[0]+h[0] : h.slice(0,2),16);
  const g=parseInt(short? h[1]+h[1] : h.slice(2,4),16);
  const b=parseInt(short? h[2]+h[2] : h.slice(4,6),16);
  return `rgba(${r},${g},${b},${alpha})`;
}
function randomStyle(){
  const arr=[
    ['#ff758c','#ff7eb3'], ['#a18cd1','#fbc2eb'],
    ['#f6d365','#fda085'], ['#84fab0','#8fd3f4'],
    ['#f093fb','#f5576c'], ['#4facfe','#00f2fe'],
    ['#43e97b','#38f9d7'], ['#fa709a','#fee140'],
    ['#30cfd0','#330867'], ['#5ee7df','#b490ca']
  ];
  const [c1,c2]=arr[Math.floor(Math.random()*arr.length)];
  return {
    bg:`linear-gradient(135deg,${c1},${c2})`,
    glow1:hexToRgba(c1,0.55),
    glow2:hexToRgba(c2,0.35)
  };
}
/* å¿ƒå½¢å‚æ•°æ–¹ç¨‹ + è‡ªé€‚åº” */
function heartScale(){
  const minDim = Math.min(window.innerWidth, window.innerHeight);
  let s = Math.round(minDim * 0.023); // ä½¿å¿ƒå½¢å®½åº¦çº¦ç­‰äº ~0.75 * minDim
  s = Math.max(8, Math.min(22, s));   // çº¦æŸèŒƒå›´
  if (dark && eco) s = Math.max(8, Math.floor(s * 0.92));
  return s;
}
function centerYOffset(){
  const portrait = window.innerHeight > window.innerWidth;
  const minDim = Math.min(window.innerWidth, window.innerHeight);
  return portrait ? -minDim * 0.06 : 0;
}
function heartXY(t){
  const s = heartScale();
  const x = s * (16 * Math.sin(t)**3);
  const y = -s * (13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t));
  return {x: x+'px', y: (y + centerYOffset())+'px'};
}
function createMsg(i,total){
  const el = document.createElement('div');
  el.className = 'msg';
  const d = directions[Math.floor(Math.random()*directions.length)];
  el.style.setProperty('--dx', d.dx);
  el.style.setProperty('--dy', d.dy);
  el.style.setProperty('--rot', rand(-55,55)+'deg');
  const baseDur = dark && eco ? rand(6.2,7.6) : rand(6.8,8.6);
  el.style.setProperty('--dur', baseDur+'s');
  el.style.setProperty('--delay', (i*0.11 + rand(0,0.35))+'s');
  const sty = randomStyle();
  el.style.setProperty('--bg', sty.bg);
  el.style.setProperty('--glow1', sty.glow1);
  el.style.setProperty('--glow2', sty.glow2);
  const t = (i / total) * Math.PI * 2; // å‡åŒ€æ˜ å°„å¿ƒå½¢
  const {x,y} = heartXY(t);
  el.style.setProperty('--heart-x', x);
  el.style.setProperty('--heart-y', y);
  el.style.setProperty('--heart-rot', rand(-18,18)+'deg');
  const span = document.createElement('span');
  span.className = 'text';
  span.textContent = tips[Math.floor(Math.random()*tips.length)];
  el.appendChild(span);
  const delay = parseFloat(el.style.getPropertyValue('--delay'));
  const dur   = parseFloat(el.style.getPropertyValue('--dur'));
  const switchAt = delay + dur * 0.86;
  const switchTimer = setTimeout(()=>{ el.classList.add('heart-mode'); }, switchAt*1000);
  el.addEventListener('animationend',()=>{
    clearTimeout(switchTimer);
    el.classList.add('heart-mode','locked','pulse');
    el.style.willChange = 'auto';
    // é¢„è®¡ç®—çˆ†ç‚¸å‘é‡ï¼ˆä¿ç•™æ¥å£ï¼‰
    const spread = rand(140, 260);
    const ang    = rand(0, Math.PI*2);
    const bx = Math.cos(ang)*spread;
    const by = Math.sin(ang)*spread;
    el.style.setProperty('--bx', bx+'px');
    el.style.setProperty('--by', by+'px');
    lockedCount++;
    if(lockedCount===totalCurrent) onAllLocked();
  }, {once:true});
  stage.appendChild(el);
}
/* è§¦å‘æœ€ç»ˆçˆ†ç‚¸ï¼ˆå½“å‰å…³é—­è‡ªåŠ¨è§¦å‘ï¼‰ */
function finalBurst(){
  stage.querySelectorAll('.msg.locked').forEach(el=>{
    el.classList.remove('pulse');
    const jitter = rand(0, 200);
    setTimeout(()=> el.classList.add('burst'), jitter);
    el.addEventListener('animationend',()=> el.remove(), {once:true});
  });
}
/* æ’­æ”¾å…¨æµç¨‹ */
function play(){
  stage.querySelectorAll('.msg').forEach(n=>n.remove());
  title.style.opacity = 0;
  const minDim = Math.min(window.innerWidth, window.innerHeight);
  let TOTAL;
  if (minDim <= 420) {
    TOTAL = dark ? (eco ? 80 : 110) : 150;
  } else if (minDim <= 720) {
    TOTAL = dark ? (eco ? 96 : 130) : 180;
  } else {
    TOTAL = dark ? (eco ? 96 : 140) : 200;
  }
  totalCurrent = TOTAL;
  lockedCount = 0;
  for(let i=0;i<TOTAL;i++) createMsg(i,TOTAL);
  setTimeout(()=>{ title.style.opacity = 1; }, 1400);
  // const TOTAL_TIME_MS = (8.6 + 0.35 + 0.3 + 2.2) * 1000;
  // setTimeout(finalBurst, TOTAL_TIME_MS);
}
/* é›ªèŠ±æ¨¡å— */
function createSnow(){
  const snow=document.createElement('div');
  snow.className='snow';
  snow.textContent='â„';
  snow.style.left=(Math.random()*100)+'vw';
  snow.style.fontSize=(Math.random()*12+8)+'px';
  snow.style.opacity=(Math.random()*0.8+0.2);
  const duration=(Math.random()*5+6);
  snow.style.animationDuration=duration+'s';
  document.body.appendChild(snow);
  setTimeout(()=>snow.remove(),duration*1000);
}
function loopSnow(ts){
  if(!lastSnowTime) lastSnowTime=ts;
  const delta=ts-lastSnowTime;
  if(delta>snowIntervalMs){
    if(snowRunning){
      const count = document.querySelectorAll('.snow').length;
      if(count < snowMax) createSnow();
    }
    lastSnowTime=ts;
  }
  snowFrame=requestAnimationFrame(loopSnow);
}
function startSnow(){ snowRunning=true; lastSnowTime=0; loopSnow(); }
function stopSnow(){ snowRunning=false; cancelAnimationFrame(snowFrame); document.querySelectorAll('.snow').forEach(s=>s.remove()); }
/* æ¨¡å¼ä¸çœç”µåˆ¤æ–­ */
function decideEco(){
  const cores = navigator.hardwareConcurrency || 4;
  const mem = navigator.deviceMemory || 4;
  const area = window.innerWidth * window.innerHeight;
  return (cores <= 4) || (mem <= 4) || (area >= 2400*1440);
}
function applyMode(){
  document.body.classList.toggle('dark', dark);
  if(dark){
    eco = decideEco();
    document.body.classList.toggle('eco', eco);
    // åˆå§‹æ·±è‰²ï¼šåŠ ä¸€äº›é›ªèŠ±
    snowIntervalMs = eco ? 800 : 500;
    snowMax = eco ? 100 : 180;
    startSnow();
  }else{
    stopSnow();
    document.body.classList.remove('eco');
  }
}
function onAllLocked(){
  // é”å®šåèµ„æºé‡Šæ”¾ï¼Œå†æå‡ä¸€ç‚¹é›ªèŠ±å¯†åº¦
  if(dark){
    snowIntervalMs = eco ? 700 : 400;
    snowMax = eco ? 140 : 240;
  }
}
/* äº‹ä»¶ */
document.addEventListener('DOMContentLoaded', () => {
  // æ˜¾ç¤ºå¼¹çª—
  const startBackdrop = document.getElementById('start-backdrop');
  startBackdrop.classList.add('active');
  
  // ç¡®è®¤æŒ‰é’®ç‚¹å‡»åï¼šéšè—å¼¹çª—+æ˜¾ç¤ºæ§åˆ¶æŒ‰é’®+åº”ç”¨æ¨¡å¼+æ’­æ”¾åŠ¨ç”»+æ’­æ”¾éŸ³ä¹
  document.getElementById('confirm-btn').addEventListener('click', () => {
    startBackdrop.classList.remove('active');
    controls.style.display = 'flex';
    document.getElementById('page-footer').style.display = 'block'; // æ˜¾ç¤ºåº•éƒ¨æ ‡è¯†
    // è®¾ç½®èƒŒæ™¯éŸ³ä¹éŸ³é‡ä¸º30%
    bgMusic.volume = 0.3;
    applyMode();
    play();
    playMusic(); // ç‚¹å‡»ç¡®å®šåæ’­æ”¾ä¸€æ¬¡éŸ³ä¹
  });
  
  // é‡æ’­æŒ‰é’®ï¼šåˆ‡æ¢æ¨¡å¼+æ’­æ”¾åŠ¨ç”»+å†æ¬¡æ’­æ”¾éŸ³ä¹
  replay.onclick = ()=>{
    dark = !dark;
    applyMode();
    play();
    playMusic();
  };
  
  // åˆ‡æ¢ä¸»é¢˜æŒ‰é’®ï¼šè·³è½¬+å†æ¬¡æ’­æ”¾éŸ³ä¹
  themeBtn.onclick = ()=>{
    playMusic();
    window.location.href = 'https://sctre.github.io/home/';
  };
});

// ç§»é™¤çª—å£resizeäº‹ä»¶ç›‘å¬ï¼Œé˜²æ­¢å…¨å±åˆ‡æ¢æ—¶åŠ¨ç”»é‡æ’­
</script>
</body>
</html>